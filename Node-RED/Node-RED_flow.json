[{"id":"7d62f7bf.d7a958","type":"tab","label":"Zuul- Websocket","disabled":false,"info":""},{"id":"a9060324.3bbcd","type":"websocket out","z":"7d62f7bf.d7a958","name":"zuul","server":"","client":"4596899a.8fb378","x":870,"y":320,"wires":[]},{"id":"8460ced2.5c034","type":"websocket in","z":"7d62f7bf.d7a958","name":"Zuul","server":"","client":"4596899a.8fb378","x":90,"y":320,"wires":[["c11f32dc.5c884"]]},{"id":"cd8bc9c2.0c9978","type":"debug","z":"7d62f7bf.d7a958","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":380,"wires":[]},{"id":"b39b8ff5.2dbcb","type":"comment","z":"7d62f7bf.d7a958","name":"Client","info":"","x":90,"y":60,"wires":[]},{"id":"744db215.47484c","type":"json","z":"7d62f7bf.d7a958","name":"","property":"payload","action":"","pretty":false,"x":370,"y":320,"wires":[["91dee0e0.8e0b8","cd8bc9c2.0c9978"]]},{"id":"b2c2caea.766728","type":"change","z":"7d62f7bf.d7a958","name":"","rules":[{"t":"set","p":"payload.type","pt":"msg","to":"ac_otprequest","tot":"str"},{"t":"set","p":"payload.config.result","pt":"msg","to":"zuul_active","tot":"flow"},{"t":"set","p":"payload.config.msg","pt":"msg","to":"zuul_msg","tot":"flow"},{"t":"set","p":"payload.config.type","pt":"msg","to":"qrcode","tot":"str"},{"t":"set","p":"payload.config.keypadchars","pt":"msg","to":"1234567890ABCD","tot":"str"},{"t":"set","p":"payload.config.length","pt":"msg","to":"10","tot":"num"},{"t":"set","p":"payload.config.valid_time","pt":"msg","to":"60","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":320,"wires":[["cd8bc9c2.0c9978","a9060324.3bbcd"]]},{"id":"91dee0e0.8e0b8","type":"switch","z":"7d62f7bf.d7a958","name":"OTP Request","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"payload.type = \"otprequest\"","vt":"jsonata"},{"t":"jsonata_exp","v":"payload.type = \"tokenstate\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":520,"y":320,"wires":[["b2c2caea.766728"],["77f3da28.4ff264"]]},{"id":"c11f32dc.5c884","type":"function","z":"7d62f7bf.d7a958","name":"Kill Session","func":"msg._session = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":320,"wires":[["744db215.47484c"]]},{"id":"9a7a2195.dd3dd","type":"inject","z":"7d62f7bf.d7a958","name":"TRUE","topic":"A","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":520,"wires":[["dc7e6bce.232718"]]},{"id":"a0fb85f7.9c7ac8","type":"inject","z":"7d62f7bf.d7a958","name":"FALSE","topic":"A","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":560,"wires":[["dc7e6bce.232718"]]},{"id":"dc7e6bce.232718","type":"rbe","z":"7d62f7bf.d7a958","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":270,"y":520,"wires":[["f7eda716.d90108","a1161043.cf88e"]]},{"id":"f7eda716.d90108","type":"change","z":"7d62f7bf.d7a958","name":"zuul_active","rules":[{"t":"set","p":"zuul_active","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":520,"wires":[[]]},{"id":"65835cef.21df14","type":"change","z":"7d62f7bf.d7a958","name":"zuul_msg_Ok","rules":[{"t":"set","p":"zuul_msg","pt":"flow","to":"Hinein spaziert! Dein QRCode ist {0} Sekunden g√ºltig","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":560,"wires":[[]]},{"id":"a1161043.cf88e","type":"switch","z":"7d62f7bf.d7a958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":580,"wires":[["65835cef.21df14"],["62fa214d.7b24e"]]},{"id":"62fa214d.7b24e","type":"change","z":"7d62f7bf.d7a958","name":"zuul_msg_Denied","rules":[{"t":"set","p":"zuul_msg","pt":"flow","to":"Passt gerade nicht..","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":600,"wires":[[]]},{"id":"8e85891d.497f58","type":"mqtt in","z":"7d62f7bf.d7a958","name":"","topic":"door/qrcode","qos":"2","datatype":"auto","broker":"51e04813.b46358","x":221,"y":58,"wires":[["f35cefa0.d03dd","beb0b84f.e2d458"]]},{"id":"f35cefa0.d03dd","type":"debug","z":"7d62f7bf.d7a958","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":461,"y":58,"wires":[]},{"id":"beb0b84f.e2d458","type":"template","z":"7d62f7bf.d7a958","name":"ac_TokenQuery","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n\"type\": \"ac_tokenquery\",\n\"config\":\n    {\n    \"token\":\"{{{payload}}}\"\n    }\n}","output":"str","x":620,"y":160,"wires":[["a9060324.3bbcd","cd8d86dc.c836e8"]]},{"id":"df56e93e.a4e768","type":"mqtt out","z":"7d62f7bf.d7a958","name":"","topic":"cmnd/tasmota/POWER","qos":"","retain":"","broker":"51e04813.b46358","x":990,"y":520,"wires":[]},{"id":"cd8d86dc.c836e8","type":"debug","z":"7d62f7bf.d7a958","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":220,"wires":[]},{"id":"77f3da28.4ff264","type":"switch","z":"7d62f7bf.d7a958","name":"","property":"payload.config.valid","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":420,"wires":[["f59c0c44.4e65b"]]},{"id":"f59c0c44.4e65b","type":"trigger","z":"7d62f7bf.d7a958","op1":"ON","op2":"OFF","op1type":"str","op2type":"str","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":810,"y":480,"wires":[["df56e93e.a4e768"]]},{"id":"4596899a.8fb378","type":"websocket-client","z":"","path":"ws://192.168.1.27:8000/ws/request","tls":"","wholemsg":"false"},{"id":"51e04813.b46358","type":"mqtt-broker","z":"","name":"docker mqtt","broker":"mqtt","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""}]